

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in &mdash; Intel® Neural Compressor  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../../" src="../../../../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../../../../" id="documentation_options" src="../../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../../../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../../index.html" class="icon icon-home"> Intel® Neural Compressor
          

          
          </a>

          
            
            
            <div class="version">
              <a href="../../../../../../../../versions.html">2.0▼</a>
              <p>Click link above to switch version</p>
            </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../Welcome.html">Intel® Neural Compressor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../examples_readme.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../api-documentation/apis.html">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../releases_info.html">Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../legal_information.html">Legal Information</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/neural-compressor">Intel® Neural Compressor repository</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Intel® Neural Compressor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../../../_sources/autoapi/neural_compressor/adaptor/tf_utils/graph_rewriter/generic/fuse_decomposed_in/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="module-neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in">
<span id="neural-compressor-adaptor-tf-utils-graph-rewriter-generic-fuse-decomposed-in"></span><h1><a class="reference internal" href="#module-neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in" title="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in</span></code></a><a class="headerlink" href="#module-neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in" title="Permalink to this heading">¶</a></h1>
<p>Fuse Decomposed InstanceNorm Graph Rewriter.</p>
<section id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this heading">¶</a></h2>
<section id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this heading">¶</a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.FuseDecomposedINOptimizer" title="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.FuseDecomposedINOptimizer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FuseDecomposedINOptimizer</span></code></a></p></td>
<td><p>Fuse decomposed small ops into InstanceNorm.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">¶</a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.node_name_from_input" title="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.node_name_from_input"><code class="xref py py-obj docutils literal notranslate"><span class="pre">node_name_from_input</span></code></a>(node_name)</p></td>
<td><p>Strips off ports and other decorations to get the underlying node name.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.node_from_map" title="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.node_from_map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">node_from_map</span></code></a>(node_map, name)</p></td>
<td><p>Pulls a node def from a dictionary for a given name.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.values_from_const" title="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.values_from_const"><code class="xref py py-obj docutils literal notranslate"><span class="pre">values_from_const</span></code></a>(node_def)</p></td>
<td><p>Extracts the values from a const NodeDef as a numpy ndarray.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.valid_reshape_inputs" title="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.valid_reshape_inputs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">valid_reshape_inputs</span></code></a>(reshape_in0_ndef, reshape_in1_ndef)</p></td>
<td><p>Check if the inputs of the Reshape are valid.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.bypass_reshape" title="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.bypass_reshape"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bypass_reshape</span></code></a>(input_node_map, input_name)</p></td>
<td><p>Get Reshape input nodes.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.get_const_dim_count" title="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.get_const_dim_count"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_const_dim_count</span></code></a>(node_def)</p></td>
<td><p>Get the number of dimensions for a Const node.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.FuseDecomposedINOptimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.</span></span><span class="sig-name descname"><span class="pre">FuseDecomposedINOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_graph_def</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.FuseDecomposedINOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Fuse decomposed small ops into InstanceNorm.</p>
<dl class="py method">
<dt class="sig sig-object py" id="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.FuseDecomposedINOptimizer.do_transformation">
<span class="sig-name descname"><span class="pre">do_transformation</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.FuseDecomposedINOptimizer.do_transformation" title="Permalink to this definition">¶</a></dt>
<dd><p>Find a group of ops that make up an instance/layer normalization pattern for fusion.</p>
<p>In some models, the instance normalizatin is performed via a group of individual
ops instead of using single InstanceNormalization op. This function identifies a
pattern of instance normalization subgraph which is made of multiple ops and
transforms the graph by replacing those individual ops with InstanceNormalization op.
This will provide the opportunity to further fold the InstanceNormalization with
convolution ops to reduce the computation steps during inference.
This function currently recognizes instance normalization patterns described
below, this could be extended if newer patterns are seen. Also, the fusion
is only attempted if the input graph is in NHWC format or has no format set.</p>
<p>The following pattern will be searched in the graph with additional
contraints. Here * means any type of op.
clang-format off</p>
<blockquote>
<div><blockquote>
<div></div></blockquote>
<dl>
<dt><a href="#id1"><span class="problematic" id="id2">*</span></a>(input)</dt><dd><p>x    x x____________
x    x              x
x    x             Mean1                                      FusedOp
x    x            x    x                                      ——-
x    x           x      x                           <a href="#id3"><span class="problematic" id="id4">*</span></a>(input)  Const  Const
x    x          x        x                              x    (gamma) (beta)
x    x         x          x                              x     x     x
x    x        x           x                _MklFusedInstanceNorm/_MklLayerNorm
x    x       x            x
x   SquaredDiff  Const    x</p>
<blockquote>
<div><dl>
<dt>x      x      x          x</dt><dd><dl>
<dt>x      x    x           x</dt><dd><dl>
<dt>x     Mean0  Const     x</dt><dd><dl>
<dt>x      x    x         x</dt><dd><dl>
<dt>x  AddV2|Add         x</dt><dd><dl>
<dt>x       x    Const  x</dt><dd><dl>
<dt>x    Rsqrt (gamma) x</dt><dd><dl>
<dt>x        x x      x</dt><dd><dl>
<dt>x       Mul1     x</dt><dd><dl>
<dt>x      x   x    x</dt><dd><dl>
<dt>x     x    x   x</dt><dd><dl>
<dt>x    x     x  x</dt><dd><dl>
<dt>x   x Constx x</dt><dd><dl>
<dt>x  x (beta)Mul2</dt><dd><p>x x    x  x
Mul0   Sub</p>
<blockquote>
<div><p>x   x</p>
</div></blockquote>
</dd>
</dl>
<p>AddV2|Add(output)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>input_graph_def</strong> – A GraphDef containing a model.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Modified graph with individual ops that made up of instance normalization
fused to InstanceNormalization.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the graph is badly formed with duplicate node names.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.node_name_from_input">
<span class="sig-prename descclassname"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.</span></span><span class="sig-name descname"><span class="pre">node_name_from_input</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.node_name_from_input" title="Permalink to this definition">¶</a></dt>
<dd><p>Strips off ports and other decorations to get the underlying node name.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.node_from_map">
<span class="sig-prename descclassname"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.</span></span><span class="sig-name descname"><span class="pre">node_from_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.node_from_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Pulls a node def from a dictionary for a given name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_map</strong> – Dictionary containing an entry indexed by name for every node.</p></li>
<li><p><strong>name</strong> – Identifies the node we want to find.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>NodeDef of the node with the given name.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the node isn’t present in the dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.values_from_const">
<span class="sig-prename descclassname"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.</span></span><span class="sig-name descname"><span class="pre">values_from_const</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_def</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.values_from_const" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts the values from a const NodeDef as a numpy ndarray.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>node_def</strong> – Const NodeDef that has the values we want to access.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Numpy ndarray containing the values.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the node isn’t a Const.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.valid_reshape_inputs">
<span class="sig-prename descclassname"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.</span></span><span class="sig-name descname"><span class="pre">valid_reshape_inputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reshape_in0_ndef</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reshape_in1_ndef</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.valid_reshape_inputs" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if the inputs of the Reshape are valid.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.bypass_reshape">
<span class="sig-prename descclassname"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.</span></span><span class="sig-name descname"><span class="pre">bypass_reshape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_node_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.bypass_reshape" title="Permalink to this definition">¶</a></dt>
<dd><p>Get Reshape input nodes.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.get_const_dim_count">
<span class="sig-prename descclassname"><span class="pre">neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.</span></span><span class="sig-name descname"><span class="pre">get_const_dim_count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_def</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#neural_compressor.adaptor.tf_utils.graph_rewriter.generic.fuse_decomposed_in.get_const_dim_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the number of dimensions for a Const node.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>node_def</strong> – Const NodeDef.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Number of dimensions for the Const node.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Intel® Neural Compressor.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>